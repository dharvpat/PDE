# ConfigMaps for Quantitative Trading System
# Non-sensitive configuration data
---
# API Server Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: api-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: api-config
data:
  config.yaml: |
    server:
      host: 0.0.0.0
      port: 8080
      workers: 4
      debug: false

    cors:
      allowed_origins:
        - "*"
      allowed_methods:
        - GET
        - POST
        - PUT
        - DELETE
      allowed_headers:
        - "*"

    rate_limiting:
      enabled: true
      requests_per_minute: 1000

    logging:
      level: INFO
      format: json
---
# Calibration Service Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: calibration-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: calibration-config
data:
  config.yaml: |
    calibration:
      heston:
        max_iterations: 1000
        tolerance: 1e-6
        use_global_optimizer: true
        feller_constraint: true

      sabr:
        beta: 0.5
        max_iterations: 500
        tolerance: 1e-5

      ou:
        estimation_method: mle
        min_observations: 100

    caching:
      enabled: true
      ttl_seconds: 3600
      max_entries: 10000

    performance:
      omp_threads: 8
      mkl_threads: 8
---
# Data Ingestion Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: data-ingestion-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: data-ingestion-config
data:
  config.yaml: |
    ingestion:
      batch_size: 1000
      flush_interval_seconds: 5
      max_retries: 3
      retry_delay_seconds: 5

    data_sources:
      primary:
        type: websocket
        reconnect_interval_seconds: 30
      backup:
        type: rest
        poll_interval_seconds: 60

    validation:
      check_timestamps: true
      max_staleness_seconds: 300
      price_change_threshold: 0.50
---
# Execution Service Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: execution-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: execution-config
data:
  mode: paper
  config.yaml: |
    execution:
      mode: paper
      max_order_size: 10000
      max_position_value: 1000000
      slippage_model: linear

    risk_checks:
      enabled: true
      max_order_value: 100000
      max_daily_loss: 50000
      max_drawdown: 0.20

    broker:
      connection_timeout_seconds: 10
      request_timeout_seconds: 30
      max_retries: 3
---
# Signals Service Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: signals-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: signals-config
data:
  config.yaml: |
    signals:
      refresh_interval_seconds: 60
      min_confidence: 0.6
      max_signals_per_symbol: 5

    strategies:
      volatility_arbitrage:
        enabled: true
        weight: 0.4
      mean_reversion:
        enabled: true
        weight: 0.4
      momentum:
        enabled: true
        weight: 0.2

    aggregation:
      method: weighted_vote
      require_consensus: false
---
# Redis Connection Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: redis-config
data:
  url: redis://redis:6379/0
---
# TimescaleDB Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: timescaledb-config
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: timescaledb-config
data:
  postgresql.conf: |
    # PostgreSQL Configuration for TimescaleDB

    # Memory Configuration
    shared_buffers = 4GB
    effective_cache_size = 12GB
    work_mem = 256MB
    maintenance_work_mem = 1GB

    # Checkpoint Configuration
    checkpoint_completion_target = 0.9
    wal_buffers = 64MB
    min_wal_size = 2GB
    max_wal_size = 8GB

    # Query Planner
    default_statistics_target = 100
    random_page_cost = 1.1
    effective_io_concurrency = 200

    # Parallelism
    max_parallel_workers_per_gather = 4
    max_parallel_workers = 8
    max_parallel_maintenance_workers = 4

    # TimescaleDB Specific
    timescaledb.max_background_workers = 8

    # Logging
    log_min_duration_statement = 1000
    log_checkpoints = on
    log_lock_waits = on
---
# TimescaleDB Init Scripts
apiVersion: v1
kind: ConfigMap
metadata:
  name: timescaledb-init
  namespace: quant-trading
  labels:
    app.kubernetes.io/name: timescaledb-init
data:
  01-init.sql: |
    -- See deploy/docker/init-scripts/timescaledb/01-init.sql
    CREATE EXTENSION IF NOT EXISTS timescaledb;
